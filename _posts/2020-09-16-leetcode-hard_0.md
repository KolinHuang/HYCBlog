---
title: 处理大数：剑指 Offer 14- II. 剪绳子 II
author: Kol Huang
date: 2020-09-16 21:14:00 +0800
categories: [Blogging, leetcode]
tags: [算法题解]
comments: true
math: true
---



这题做了很久，做不出来，看题解也看了好久，难点在于证明过程，以及如何对大数求余。这题单独列出来，需要多看看，否则下次碰到了还是不会。

## 题目描述

给你一根长度为 n 的绳子，请把绳子剪成整数长度的 m 段（m、n都是整数，n>1并且m>1），每段绳子的长度记为 k[0],k[1]...k[m - 1] 。请问 k[0]*k[1]*...*k[m - 1] 可能的最大乘积是多少？例如，当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到的最大乘积是18。

答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。

 示例 1：

```java
输入: 2
输出: 1
解释: 2 = 1 + 1, 1 × 1 = 1
示例 2:

输入: 10
输出: 36
解释: 10 = 3 + 3 + 4, 3 × 3 × 4 = 36
```


提示：

* 2 <= n <= 1000

## 解题思路

题意理解：设将长度为n的绳子切为a段：<br>
$$
n = n_{1} + n_{2} + ... + n_{a}
$$
<br>求：<br>
$$
max(n_{1} \times n_{2} \times ... \times n_{a})
$$
<br>

<br>

**数学推导：**<br>

<br>
$$
\frac{n_{1} + n_{2} + ... + n_{a}}{a} \geq \sqrt[a]{n_{1} \times n_{2} \times ... \times n_{a}}
$$
<br>

<br>以上公式为“算数几何均值不等式”，等号当且仅当$${n_{1}=n_{2}=...=n_{a}}$$时成立。

所以得出推论：

> 将绳子以相等的长度等分为多段，得到的乘积最大

设将绳子按长度x等分为a段，即$${n=ax}$$，则乘积为$${x^a}$$。所以有：<br>

<br>
$$
x^a = x ^ \frac{n}{x} = (x^\frac{1}{x} )^n
$$
<br>

<br>由于n是常数，因此当$${x^\frac{1}{x}}$$取得最大值时，乘积达到最大。所以问题就转化为求$${y = x^\frac{1}{x}}$$的极大值。求导：<br>

<br>
$$
ln\ y = \frac{1}{x}ln\ x-取对数\\
$$
<br>

<br>
$$
\frac{1}{y}y' = \frac{1}{x^2} - \frac{1}{x^2}ln\ x-对x求导\\
$$
<br>

<br>
$$
=\frac{1-ln\ x}{x^2}\\
$$
<br>

<br>
$$
y' = \frac{1-ln\ x}{x^2} x^\frac{1}{x}-整理得
$$


<br>

令$${y'=0}$$，则$${1-ln\ x=0}$$，求得驻点为$${x_0 = e \approx2.7}$$，根据上式单调性，可知$${x_0}$$是极大值点。

所以当把绳子e等分的时候，乘积最大。但是本题要求切分长度x必须为整数，所以最接近的数为2或3。将2和3带入方程$$y = f(x)$$中，得出$$x =3$$时，乘积最大。

所以把绳子尽可能切分为长度为3的片段，留下的最后一段绳子长度可能为0，1，2三种情况。

* 若最后一段绳子长度为2：则保留，不再拆为$$1\times1$$
* 若最后一段绳子长度为1：则应把一份$$3\times1$$替换为$$2\times2$$。

所以算法设计如下：

```java
当n <= 3时，不切分，但是由于题目要求必须剪成 m>1段，因此必须剪出一段长度为1的绳子，即返回n−1。
当n > 3时，求n除3的整数a和余数b：
  1. 当b = 0时，返回 3^a % 1000000007;
	2. 当b = 1时，返回(3^a*4)%1000000007;
	3. 当b = 2时，返回(3^a*2)%1000000007;
```

> 当整数a较大时，最后返回的3^a可能会超出int32甚至int64的范围，所以这是一个大数求余问题。

大数求余问题：在仅使用`int32`类型存储的前提下，正确计算$$x^a$$对p求余后的值。

有两种方法：

1. 循环求余法：<br>
   $$
   x^a\odot p=[(x^{a-1}\odot p)(x \odot p)]\odot p = [(x^{a-1}\odot p)x] \odot p
   $$
   <br>利用此公司可以依次求得$$x^1,x^2,x^3,...,x^a$$对p的余数



```java
class Solution {
    public int cuttingRope(int n) {
        if(n <= 3) return n-1;
        int b = n % 3;
        int p = 1000000007;
        long res = 1;
        int x = 3;
        //循环求余
        //从1开始，这样少求一个，留一段最后看b的情况分
        for(int i = 1; i < n / x; ++i){
            res = (res * x) % p;
        }
        //正好分完，剩余一段长度为3，直接乘上去
        if(b == 0)  return (int)(res * 3 % p);
        //余数为1，说明剩余一段长度为4，需要分为2*2的两段，所以乘4
        if(b == 1)  return (int)(res * 4 % p);
        //余数为2，说明剩余一段长度为5，需要分为2*3的两段，所以乘6
        return (int)(res*6 % p);
    }  
}
```

2. 快速幂求余法：<br>
   $$
   x^a \odot p = (x^2)^{a/2}\odot p = (x^2 \odot p)^{a/2}\odot p
   $$
   <br>当a为奇数时，a/2不是整数，因此分以下两种情况：<br>
   $$
   x^a \odot p = 
   \begin{cases}
   (x^2\odot p)^{a//2}\odot p--a为偶数\\
   [(x\odot p)(x^{a-1}\odot p)] \odot p = [x(x^2\odot p)^{a//2}]\odot p--a为奇数
   \end{cases}
   $$
   <br>

```java
class Solution {
    public int cuttingRope(int n) {
        if(n <= 3) return n - 1;
        int b = n % 3, p = 1000000007;
        long rem = 1, x = 3;
      	//
        for(int a = n / 3 - 1; a > 0; a /= 2) {
          	//a为奇数
            if(a % 2 == 1) rem = (rem * x) % p;
            x = (x * x) % p;
        }
        if(b == 0) return (int)(rem * 3 % p);
        if(b == 1) return (int)(rem * 4 % p);
        return (int)(rem * 6 % p);
    }
}
```



做这类大数乘法题一定要注意结果会不会溢出。

