<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spring：AOP（面向切面编程） | 黄玉才的博客</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Spring：AOP（面向切面编程）" /><meta name="author" content="Kol Huang" /><meta property="og:locale" content="en_US" /><meta name="description" content="AOP：Aspect Oriented Programming，意为面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发效率。" /><meta property="og:description" content="AOP：Aspect Oriented Programming，意为面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发效率。" /><link rel="canonical" href="www.yucaihuang.com/HYCBlog/posts/web-javaweb-spring_5/" /><meta property="og:url" content="www.yucaihuang.com/HYCBlog/posts/web-javaweb-spring_5/" /><meta property="og:site_name" content="黄玉才的博客" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-05T21:42:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring：AOP（面向切面编程）" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Kol Huang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"www.yucaihuang.com/HYCBlog/posts/web-javaweb-spring_5/"},"url":"www.yucaihuang.com/HYCBlog/posts/web-javaweb-spring_5/","author":{"@type":"Person","name":"Kol Huang"},"description":"AOP：Aspect Oriented Programming，意为面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发效率。","dateModified":"2020-09-05T21:42:00+08:00","datePublished":"2020-09-05T21:42:00+08:00","headline":"Spring：AOP（面向切面编程）","@type":"BlogPosting","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/HYCBlog/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/HYCBlog/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/HYCBlog/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/HYCBlog/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/HYCBlog/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/HYCBlog/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/HYCBlog/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/HYCBlog/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/HYCBlog/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/HYCBlog/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/HYCBlog/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/HYCBlog/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/HYCBlog/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/HYCBlog/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/HYCBlog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/HYCBlog/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/HYCBlog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/HYCBlog/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/HYCBlog/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/HYCBlog/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/HYCBlog/assets/css/post.css"><link rel="stylesheet" href="/HYCBlog/assets/css/post.css"><link rel="preload" as="style" href="/HYCBlog/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/HYCBlog/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176388509-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-176388509-1'); </script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/HYCBlog/assets/js/post.min.js" async></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script> <script src="/HYCBlog/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="http://www.yucaihuang.com" alt="avatar"> <img src="/HYCBlog/assets/img/daliy/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/HYCBlog/">黄玉才的博客</a></div><div class="site-subtitle font-italic">把开源的变成自己的，把自己的变成祖传的!</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/KolinHuang" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['yc_huang97','163.com'].join('@'))" > <i class="fas fa-envelope"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/HYCBlog/"> Posts </a> </span> <span>Spring：AOP（面向切面编程）</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring：AOP（面向切面编程）</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Sep 5, 2020, 9:42 PM +0800" > Sep 5 <i class="unloaded">2020-09-05T21:42:00+08:00</i> </span> by <span class="author"> Kol Huang</div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Sep 8, 2020, 8:36 AM +0800" > Sep 8 <i class="unloaded">2020-09-08T08:36:18+08:00</i> </span></div></div><div class="post-content"><p>AOP：Aspect Oriented Programming，意为面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发效率。</p><p>简单的说，就是AOP把程序中重复的代码抽取出来，在需要执行的时候，使用动态代理的技术，在不修改源码的基础上，对已有的方法进行增强。</p><h2 id="事务控制下的转账功能实现">事务控制下的转账功能实现</h2><p>定义和事物管理相关的工具类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 和事务管理相关的工具类，它包含了：开启事务，提交事务，回滚事务和释放连接
 */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"transactionManager"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionManager</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ConnectionUtils</span> <span class="n">connectionUtils</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beginTransaction</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">().</span><span class="na">setAutoCommit</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">commit</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rollback</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">().</span><span class="na">rollback</span><span class="o">();</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 释放连接
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">release</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">().</span><span class="na">close</span><span class="o">();</span><span class="c1">//  放回连接池</span>
            <span class="c1">//连接与线程解绑</span>
            <span class="n">connectionUtils</span><span class="o">.</span><span class="na">removeConnection</span><span class="o">();</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>定义连接的工具类，用于从数据源中获取一个连接，并且实现和线程的绑定：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 连接的工具类，用于从数据源中获取一个连接，并且实现和线程的绑定
 */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"connectionUtils"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConnectionUtils</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">Connection</span><span class="o">&gt;</span> <span class="n">tl</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">Connection</span><span class="o">&gt;();</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Connection</span> <span class="nf">getConnection</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//先从ThreadLocal上获取</span>
            <span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">tl</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">conn</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                <span class="c1">//从数据源中获取一个连接，并且存入ThreadLocal中</span>
                <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
                <span class="n">tl</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">conn</span><span class="o">;</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 把线程和连接解绑
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeConnection</span><span class="o">(){</span>
        <span class="n">tl</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>在accountDao的实现类中使用获取连接工具类获取数据库连接，并将参数传给runner用于在持久层进行数据库查询操作：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountDaoImpl</span> <span class="kd">implements</span> <span class="nc">IAccountDao</span> <span class="o">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">QueryRunner</span> <span class="n">runner</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">ConnectionUtils</span> <span class="n">connectionUtils</span><span class="o">;</span>


  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findAllAccount</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">runner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"select * from account"</span><span class="o">,</span><span class="k">new</span> <span class="nc">BeanListHandler</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">runner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"select * from account where id = ?"</span><span class="o">,</span><span class="k">new</span> <span class="nc">BeanHandler</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">),</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">runner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"insert into account(name,money)values(?,?)"</span><span class="o">,</span><span class="n">account</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">account</span><span class="o">.</span><span class="na">getMoney</span><span class="o">());</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">runner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"update account set name=?,money=? where id=?"</span><span class="o">,</span><span class="n">account</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">account</span><span class="o">.</span><span class="na">getMoney</span><span class="o">(),</span><span class="n">account</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAccount</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">runner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"delete from account where id=?"</span><span class="o">,</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span>  <span class="n">runner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"select * from account where name = ?"</span><span class="o">,</span><span class="k">new</span> <span class="nc">BeanListHandler</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">),</span><span class="n">name</span><span class="o">);</span>
      <span class="k">if</span><span class="o">(</span><span class="n">accounts</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">if</span><span class="o">(</span><span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"数据查询错误"</span><span class="o">);</span>

      <span class="k">return</span> <span class="n">accounts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>在AccountService实现类中利用事务管理器实现在业务层管理事务：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 账户的业务层实现类
 *  事务控制应该都在业务层
 *
 */</span>

<span class="nd">@Service</span><span class="o">(</span><span class="s">"accountService"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="nc">IAccountService</span> <span class="o">{</span>


    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">IAccountDao</span> <span class="n">accountDao</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">TransactionManager</span> <span class="n">transactionManager</span><span class="o">;</span>


<span class="c1">//    public void setAccountDao(IAccountDao accountDao) {</span>
<span class="c1">//        this.accountDao = accountDao;</span>
<span class="c1">//    }</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findAllAccount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//开启事务</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
            <span class="c1">//执行操作</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAllAccount</span><span class="o">();</span>
            <span class="c1">//提交事务</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
            <span class="c1">//返回结果</span>
            <span class="k">return</span> <span class="n">accounts</span><span class="o">;</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//回滚操作</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//释放连接</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//开启事务</span>
            <span class="c1">//执行操作</span>
            <span class="c1">//提交事务</span>
            <span class="c1">//返回结果</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//回滚操作</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//释放连接</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//开启事务</span>
            <span class="c1">//执行操作</span>
            <span class="c1">//提交事务</span>
            <span class="c1">//返回结果</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//回滚操作</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//释放连接</span>
        <span class="o">}</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">saveAccount</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//开启事务</span>
            <span class="c1">//执行操作</span>
            <span class="c1">//提交事务</span>
            <span class="c1">//返回结果</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//回滚操作</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//释放连接</span>
        <span class="o">}</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">updateAccount</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAccount</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//开启事务</span>
            <span class="c1">//执行操作</span>
            <span class="c1">//提交事务</span>
            <span class="c1">//返回结果</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//回滚操作</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//释放连接</span>
        <span class="o">}</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">deleteAccount</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//开启事务</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
            <span class="c1">//执行操作</span>
            <span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="c1">//提交事务</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
            <span class="c1">//返回结果</span>
            <span class="k">return</span> <span class="n">account</span><span class="o">;</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//回滚操作</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//释放连接</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="nc">String</span> <span class="n">sourceName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">targetName</span><span class="o">,</span> <span class="nc">Float</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//需要使用ThreadLocal对象把Connection和当前线程绑定，从而使一个线程中只有一个能控制事务的对象</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//开启事务</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
            <span class="c1">//执行操作</span>
            <span class="c1">//1. 根据名称查询转出账户</span>
            <span class="nc">Account</span> <span class="n">sourceAccount</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountByName</span><span class="o">(</span><span class="n">sourceName</span><span class="o">);</span>
            <span class="c1">//2. 根据名称查询转入账户</span>
            <span class="nc">Account</span> <span class="n">targetAccount</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountByName</span><span class="o">(</span><span class="n">targetName</span><span class="o">);</span>
            <span class="c1">//3. 转出账户减钱</span>
            <span class="n">sourceAccount</span><span class="o">.</span><span class="na">setMoney</span><span class="o">(</span><span class="n">sourceAccount</span><span class="o">.</span><span class="na">getMoney</span><span class="o">()</span> <span class="o">-</span> <span class="n">money</span><span class="o">);</span>
            <span class="c1">//4. 转入账户加钱</span>
            <span class="n">targetAccount</span><span class="o">.</span><span class="na">setMoney</span><span class="o">(</span><span class="n">targetAccount</span><span class="o">.</span><span class="na">getMoney</span><span class="o">()</span> <span class="o">+</span> <span class="n">money</span><span class="o">);</span>
            <span class="c1">//5. 更新转出账户</span>
            <span class="n">accountDao</span><span class="o">.</span><span class="na">updateAccount</span><span class="o">(</span><span class="n">sourceAccount</span><span class="o">);</span>
<span class="c1">//            int i = 1/0;</span>
            <span class="c1">//6. 更新转入账户</span>
            <span class="n">accountDao</span><span class="o">.</span><span class="na">updateAccount</span><span class="o">(</span><span class="n">targetAccount</span><span class="o">);</span>
            <span class="c1">//提交事务</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>

        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//回滚操作</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//释放连接</span>
            <span class="n">transactionManager</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>为了在进行数据库操作时，保证操作的原子性，需要执行事务控制。</p><h2 id="基于接口的动态代理">基于接口的动态代理</h2><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="p">*</span> 动态代理：
		特点：字节码随用随创建，随用随加载
		作用：不修改源码的基础上对方法增强
		分类：基于接口的动态代理、基于子类的动态代理
		基于接口的动态代理：
			涉及的类：Proxy
			提供者：JDK官方
			如何创建代理对象：使用Proxy类中的newProxyInstance方法
			创建代理对象的要求：被代理类最少实现一个接口，如果没有则不能使用
			newProxyInstance的参数：
					ClassLoader:用于加载代理对象字节码的，和被代理对象使用相同的类加载器。固定写法
					Class[]:用于让代理对象和被代理对象有相同的方法。固定写法
					InvocationHandler:用于提供增强的代码，让我们写如何代理。一般都是写一个该接口的实现类，通常情况下都是匿名内部类，但不是必须的。此接口的实现类都是谁用谁写。
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Producer</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Producer</span><span class="o">();</span>
         <span class="nc">IProducer</span> <span class="n">proxyProducer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">IProducer</span><span class="o">)</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">producer</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span>
                <span class="n">producer</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span>
                <span class="k">new</span> <span class="nf">InvocationHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="cm">/**
                     * 执行被代理对象的任何接口方法都会经过该方法
                     * @param proxy     代理对象的引用
                     * @param method    当前执行的方法
                     * @param args      当前执行方法所需的参数
                     * @return 和被代理对象方法有相同的返回值
                     * @throws Throwable
                     */</span>
                    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
												<span class="c1">//增强的代码</span>
                        <span class="nc">Object</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                        
                        <span class="c1">//判断当前方法是不是销售</span>
                        <span class="k">if</span> <span class="o">(</span><span class="s">"saleProduct"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()))</span> <span class="o">{</span>
                          	<span class="c1">//获取方法执行的参数</span>
                        		<span class="nc">Float</span> <span class="n">money</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Float</span><span class="o">)</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
                            <span class="n">returnValue</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">producer</span><span class="o">,</span> <span class="n">money</span> <span class="o">*</span> <span class="mf">0.8f</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="k">return</span> <span class="n">returnValue</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">});</span>
         <span class="n">proxyProducer</span><span class="o">.</span><span class="na">saleProduct</span><span class="o">(</span><span class="mi">10000</span><span class="n">f</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>被代理对象所属类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 一个生产者
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">implements</span> <span class="nc">IProducer</span> <span class="o">{</span>
    <span class="cm">/**
     * 销售
     * @param money
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saleProduct</span><span class="o">(</span><span class="kt">float</span> <span class="n">money</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"销售产品，并拿到钱："</span><span class="o">+</span><span class="n">money</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 售后
     * @param money
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterService</span><span class="o">(</span><span class="kt">float</span> <span class="n">money</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"提供售后服务，并拿到钱："</span><span class="o">+</span><span class="n">money</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>接口：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 对生产厂家要求的接口
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IProducer</span> <span class="o">{</span>
    <span class="cm">/**
     * 销售
     * @param money
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saleProduct</span><span class="o">(</span><span class="kt">float</span> <span class="n">money</span><span class="o">);</span>

    <span class="cm">/**
     * 售后
     * @param money
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterService</span><span class="o">(</span><span class="kt">float</span> <span class="n">money</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>使用<code class="language-plaintext highlighter-rouge">Proxy</code>类的<code class="language-plaintext highlighter-rouge">newProxyInstance</code>方法创建了代理对象<code class="language-plaintext highlighter-rouge">proxyProducer</code>，在参数中配置信息，使得代理对象也拥有被代理对象<code class="language-plaintext highlighter-rouge">Producer</code>的所有方法（<code class="language-plaintext highlighter-rouge">saleProduct()</code>），并通过<code class="language-plaintext highlighter-rouge">invoke()</code>方法对被代理对象的方法进行增强。</p><h2 id="基于子类的动态代理">基于子类的动态代理</h2><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>基于子类的动态代理：
			涉及的类：Enhancer
			提供者：第三方cglib库
			如何创建代理对象：使用Enhancer类中的create法
			创建代理对象的要求：被代理类不能是最终类
			create的参数：
					Class:用于指定被代理对象的字节码
					Callback:用于提供增强的代码。一般写的都是该接口的子接口实现类，MethodInterceptor
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.yucaihuang.cglib</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">net.sf.cglib.proxy.Enhancer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.sf.cglib.proxy.MethodInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">net.sf.cglib.proxy.MethodProxy</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Producer</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Producer</span><span class="o">();</span>

        <span class="nc">Producer</span> <span class="n">cglibProducer</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Producer</span><span class="o">)</span> <span class="nc">Enhancer</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">producer</span><span class="o">.</span><span class="na">getClass</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">MethodInterceptor</span><span class="o">()</span> <span class="o">{</span>
            <span class="cm">/**
             * 执行被代理对象的任何方法都会经过此方法
             * @param o         代理对象的引用
             * @param method    当前执行的方法
             * @param objects   当前执行方法所需的参数
             * 以上三个参数和基于接口的动态代理中invoke方法的参数是一样的。
             * @param methodProxy   当前执行方法的代理对象
             * @return 和被代理对象方法有相同的返回值
             * @throws Throwable
             */</span>
            <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">intercept</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">objects</span><span class="o">,</span> <span class="nc">MethodProxy</span> <span class="n">methodProxy</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
                <span class="c1">//增强的代码</span>
                <span class="nc">Object</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

                <span class="c1">//判断当前方法是不是销售</span>
                <span class="k">if</span> <span class="o">(</span><span class="s">"saleProduct"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()))</span> <span class="o">{</span>
                    <span class="c1">//获取方法执行的参数</span>
                    <span class="nc">Float</span> <span class="n">money</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Float</span><span class="o">)</span> <span class="n">objects</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
                    <span class="n">returnValue</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">producer</span><span class="o">,</span> <span class="n">money</span> <span class="o">*</span> <span class="mf">0.7f</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">returnValue</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">cglibProducer</span><span class="o">.</span><span class="na">saleProduct</span><span class="o">(</span><span class="mi">10000</span><span class="n">f</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="使用动态代理实现事务控制">使用动态代理实现事务控制</h2><p>持久层实现类：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountDaoImpl</span> <span class="kd">implements</span> <span class="nc">IAccountDao</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="nc">QueryRunner</span> <span class="n">runner</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nc">ConnectionUtils</span> <span class="n">connectionUtils</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRunner</span><span class="o">(</span><span class="nc">QueryRunner</span> <span class="n">runner</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">runner</span> <span class="o">=</span> <span class="n">runner</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setConnectionUtils</span><span class="o">(</span><span class="nc">ConnectionUtils</span> <span class="n">connectionUtils</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">connectionUtils</span> <span class="o">=</span> <span class="n">connectionUtils</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findAllAccount</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">runner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"select * from account"</span><span class="o">,</span><span class="k">new</span> <span class="nc">BeanListHandler</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">runner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"select * from account where id = ?"</span><span class="o">,</span><span class="k">new</span> <span class="nc">BeanHandler</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">),</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">runner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"insert into account(name,money)values(?,?)"</span><span class="o">,</span><span class="n">account</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">account</span><span class="o">.</span><span class="na">getMoney</span><span class="o">());</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">runner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"update account set name=?,money=? where id=?"</span><span class="o">,</span><span class="n">account</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">account</span><span class="o">.</span><span class="na">getMoney</span><span class="o">(),</span><span class="n">account</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAccount</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">runner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"delete from account where id=?"</span><span class="o">,</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accounts</span> <span class="o">=</span>  <span class="n">runner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">connectionUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(),</span><span class="s">"select * from account where name = ?"</span><span class="o">,</span><span class="k">new</span> <span class="nc">BeanListHandler</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;(</span><span class="nc">Account</span><span class="o">.</span><span class="na">class</span><span class="o">),</span><span class="n">name</span><span class="o">);</span>
      <span class="k">if</span><span class="o">(</span><span class="n">accounts</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">if</span><span class="o">(</span><span class="n">accounts</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"数据查询错误"</span><span class="o">);</span>

      <span class="k">return</span> <span class="n">accounts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>业务层实现类：事务控制从业务层中移除，放入代理对象中</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="nc">IAccountService</span> <span class="o">{</span>


    <span class="kd">private</span> <span class="nc">IAccountDao</span> <span class="n">accountDao</span><span class="o">;</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAccountDao</span><span class="o">(</span><span class="nc">IAccountDao</span> <span class="n">accountDao</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">accountDao</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="nf">findAllAccount</span><span class="o">()</span> <span class="o">{</span>

        <span class="k">return</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAllAccount</span><span class="o">();</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">saveAccount</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateAccount</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">updateAccount</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAccount</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">deleteAccount</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Account</span> <span class="nf">findAccountByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>


    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="nc">String</span> <span class="n">sourceName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">targetName</span><span class="o">,</span> <span class="nc">Float</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>



        <span class="c1">//1. 根据名称查询转出账户</span>
        <span class="nc">Account</span> <span class="n">sourceAccount</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountByName</span><span class="o">(</span><span class="n">sourceName</span><span class="o">);</span>
        <span class="c1">//2. 根据名称查询转入账户</span>
        <span class="nc">Account</span> <span class="n">targetAccount</span> <span class="o">=</span> <span class="n">accountDao</span><span class="o">.</span><span class="na">findAccountByName</span><span class="o">(</span><span class="n">targetName</span><span class="o">);</span>
        <span class="c1">//3. 转出账户减钱</span>
        <span class="n">sourceAccount</span><span class="o">.</span><span class="na">setMoney</span><span class="o">(</span><span class="n">sourceAccount</span><span class="o">.</span><span class="na">getMoney</span><span class="o">()</span> <span class="o">-</span> <span class="n">money</span><span class="o">);</span>
        <span class="c1">//4. 转入账户加钱</span>
        <span class="n">targetAccount</span><span class="o">.</span><span class="na">setMoney</span><span class="o">(</span><span class="n">targetAccount</span><span class="o">.</span><span class="na">getMoney</span><span class="o">()</span> <span class="o">+</span> <span class="n">money</span><span class="o">);</span>
        <span class="c1">//5. 更新转出账户</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">updateAccount</span><span class="o">(</span><span class="n">sourceAccount</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="o">;</span>
        <span class="c1">//6. 更新转入账户</span>
        <span class="n">accountDao</span><span class="o">.</span><span class="na">updateAccount</span><span class="o">(</span><span class="n">targetAccount</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>编写用于创建service代理对象的工厂类，该代理对象对service对象的各个方法进行增强，实现事务控制：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 用于创建service的代理对象的工厂
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanFactory</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">IAccountService</span> <span class="n">accountService</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">TransactionManager</span> <span class="n">transactionManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAccountService</span><span class="o">(</span><span class="nc">IAccountService</span> <span class="n">accountService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">accountService</span> <span class="o">=</span> <span class="n">accountService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTransactionManager</span><span class="o">(</span><span class="nc">TransactionManager</span> <span class="n">transactionManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">transactionManager</span> <span class="o">=</span> <span class="n">transactionManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 获取Service代理对象
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">IAccountService</span> <span class="nf">getAccountService</span><span class="o">(){</span>
        <span class="nc">IAccountService</span> <span class="n">proxyAccountService</span> <span class="o">=</span> <span class="o">(</span><span class="nc">IAccountService</span><span class="o">)</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">accountService</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span>
                <span class="n">accountService</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span>
                <span class="k">new</span> <span class="nf">InvocationHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="cm">/**
                     * 添加事务的支持
                     * @param proxy
                     * @param method
                     * @param args
                     * @return
                     * @throws Throwable
                     */</span>
                    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
                        <span class="nc">Object</span> <span class="n">rtValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                        <span class="k">try</span><span class="o">{</span>
                            <span class="c1">//开启事务</span>
                            <span class="n">transactionManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
                            <span class="c1">//执行操作</span>
                            <span class="n">rtValue</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">accountService</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
                            <span class="c1">//提交事务</span>
                            <span class="n">transactionManager</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
                            <span class="c1">//返回结果</span>
                            <span class="k">return</span> <span class="n">rtValue</span><span class="o">;</span>
                        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
                            <span class="c1">//回滚操作</span>
                            <span class="n">transactionManager</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
                            <span class="c1">//释放连接</span>
                            <span class="n">transactionManager</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">});</span>

        <span class="k">return</span> <span class="n">proxyAccountService</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>测试：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 使用Junit单元测试进行操作
 */</span>
<span class="c1">//</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">locations</span> <span class="o">=</span> <span class="s">"classpath:bean.xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountServiceTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"proxyAccountService"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">IAccountService</span> <span class="n">as</span><span class="o">;</span>

    <span class="nd">@Test</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFindAccountByName</span><span class="o">(){</span>
        <span class="nc">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">as</span><span class="o">.</span><span class="na">findAccountByName</span><span class="o">(</span><span class="s">"aaa"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testTransfer</span><span class="o">(){</span>
        <span class="n">as</span><span class="o">.</span><span class="na">transfer</span><span class="o">(</span><span class="s">"aaa"</span><span class="o">,</span><span class="s">"bbb"</span><span class="o">,</span><span class="mf">100.0f</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Bean.xml的配置：</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        https://www.springframework.org/schema/context/spring-context.xsd"</span><span class="nt">&gt;</span>



<span class="c">&lt;!--    配置数据源--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--        连接数据库的必备信息--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jdbcUrl"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/eesy_mybatis"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"qazwsxedc7410"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

  	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"accountService"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.service.impl.AccountServiceImpl"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"accountDao"</span> <span class="na">ref=</span><span class="s">"accountDao"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
  
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"accountDao"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.dao.impl.AccountDaoImpl"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"runner"</span> <span class="na">ref=</span><span class="s">"runner"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connectionUtils"</span> <span class="na">ref=</span><span class="s">"connectionUtils"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
  
    <span class="c">&lt;!--    配置QueryRunner--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"runner"</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbutils.QueryRunner"</span> <span class="na">scope=</span><span class="s">"prototype"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
  
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"connectionUtils"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.utils.ConnectionUtils"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"beanFactory"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.factory.BeanFactory"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"transactionManager"</span> <span class="na">ref=</span><span class="s">"transactionManager"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"accountService"</span> <span class="na">ref=</span><span class="s">"accountService"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"transactionManager"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.utils.TransactionManager"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connectionUtils"</span> <span class="na">ref=</span><span class="s">"connectionUtils"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"proxyAccountService"</span> <span class="na">factory-bean=</span><span class="s">"beanFactory"</span> <span class="na">factory-method=</span><span class="s">"getAccountService"</span><span class="nt">&gt;&lt;/bean&gt;</span>
  
<span class="nt">&lt;/beans&gt;</span>

</pre></table></code></div></div><h2 id="spring中的aop">Spring中的AOP</h2><h3 id="相关术语">相关术语</h3><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="p">*</span> Joinpoint(连接点)：
		指那些被拦截到的点。在Spring中，这些点指的是方法，因为spring只支持方法类型的连接点。
<span class="p">*</span> Pointcut(切入点)：
		指我们要对哪些Joinpoint进行拦截的定义。
<span class="p">*</span>	Advice(通知/增强)：
		拦截到Joinpoint之后所要做的事情就是通知。
		通知的类型：前置通知，后置通知，异常通知，最终通知，环绕通知。
<span class="p">*</span> Introduction(引介)：
		是一种特殊的通知，在不修改类代码的前提下，Introduction可以在运行期为类动态地添加一些方法或Field
<span class="p">*</span> Target(目标对象)：
		代理的目标对象
<span class="p">*</span> Weaving(织入)：
		是指把增强应用到目标对象来创建新的代理对象的过程。
		Spring采用动态代理织入，而AspectJ采用编译器和类装载期织入。
<span class="p">*</span> Proxy(代理)：
		一个类被AOP织入增强后，就产生了一个结果代理类
<span class="p">*</span> Aspect(切面)：
		是切入点和通知(引介)的结合
</pre></table></code></div></div><h3 id="spring基于xml的aop配置">Spring基于xml的AOP配置</h3><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="p">*</span> spring中基于XML的AOP配置步骤：
		1、把通知Bean也交给spring来管理
		2、使用aop:config标签表明开始AOP的配置
		3、使用aop:aspect标签表明配置切面
				id属性：是给切面提供一个唯一的标识
				ref属性：是指定通知类bean的id
		4、在aop:aspect标签的内部使用对应标签来配置通知的类型
				前置通知：aop:before标签
						method属性：用于指定Logger类中哪个方法是前置通知
						pointcut属性：用于指定切入点表达式，该表达式的含义指的是对业务层中哪些方法增强
							
				后置通知：aop:after标签
切入点表达式的写法：
    关键字：execution(表达式)
    表达式： 访问修饰符 返回值 包名.类名.方法名(参数列表)
    例：public void com.yucaihuang.service.impl.AccountServiceImpl.saveAccount()
    访问修饰符可以省略：
    void com.yucaihuang.service.impl.AccountServiceImpl.saveAccount()
    返回值可以使用通配符，表示任意返回值
<span class="p">    *</span> com.yucaihuang.service.impl.AccountServiceImpl.saveAccount()
    包名可以使用通配符，表示任意包。但是有几级包就写几个<span class="err">*</span>.
<span class="p">    *</span> <span class="ge">*.*</span>.<span class="ge">*.*</span>.AccountServiceImpl.saveAccount()
    包名可以是使用..表示当前包及其子包
<span class="p">    *</span> <span class="err">*</span>..AccountServiceImpl.saveAccount()
    类名可以用<span class="err">*</span>表示当前包下的所有类
<span class="p">    *</span> <span class="ge">*..*</span>.saveAccount()
    方法名同理：
<span class="p">    *</span> <span class="ge">*..*</span>.<span class="err">*</span>()
    方法的参数可用..表示任意参数
    也可以直接写数据类型：
			基本类型直接写名称				Integer
			引用类型写包名.类名的方法 java.lang.String
    全通配写法：<span class="ge">* *</span>..<span class="ge">*.*</span>(..)				
    
实际开发中，切入点表达式的通常写法：切到业务层实现类下的所有方法
<span class="p">		*</span> com.yucaihuang.service.impl.<span class="ge">*.*</span>(..)
</pre></table></code></div></div><p>bean.xml文件配置如下：</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:aop=</span><span class="s">"http://www.springframework.org/schema/aop"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        https://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="nt">&gt;</span>

<span class="c">&lt;!--    配置spring的Ioc，把service对象配置进来--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"accountService"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.service.impl.AccountServiceImpl"</span><span class="nt">/&gt;</span>

<span class="c">&lt;!--    Spring中基于xml的AOP配置步骤--&gt;</span>

<span class="c">&lt;!--    配置Logger类--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"logger"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.utils.Logger"</span><span class="nt">/&gt;</span>

<span class="c">&lt;!--    配置AOP--&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
<span class="c">&lt;!--        配置切面--&gt;</span>
        <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">"logAdvice"</span> <span class="na">ref=</span><span class="s">"logger"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--            配置通知的类型，并且建立通知方法和切入点方法的关联--&gt;</span>
            <span class="nt">&lt;aop:before</span> <span class="na">method=</span><span class="s">"printLog"</span> <span class="na">pointcut=</span><span class="s">"execution(* com.yucaihuang.service.impl.*.*(..))"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/aop:aspect&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>
<span class="nt">&lt;/beans&gt;</span>

</pre></table></code></div></div><h3 id="四种常用类型通知">四种常用类型通知</h3><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c">&lt;!--            配置切入点表达式：id属性用于指定表达式的唯一标识。expression属性用于指定表达式内容
    此标签写在aop:aspect标签内部，只能当前切面使用，它还可以写在aop:aspect标签外面，所有切面可用
    必须放在aspect标签之前
--&gt;</span>
        <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"pt1"</span> <span class="na">expression=</span><span class="s">"execution(* com.yucaihuang.service.impl.*.*(..))"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--        配置切面--&gt;</span>
        <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">"logAdvice"</span> <span class="na">ref=</span><span class="s">"logger"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--            配置通知的类型，并且建立通知方法和切入点方法的关联--&gt;</span>
<span class="c">&lt;!--            前置通知：在切入点方法执行之前执行--&gt;</span>
            <span class="nt">&lt;aop:before</span> <span class="na">method=</span><span class="s">"beforePrintLog"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--            后置通知：在切入点方法正常执行之后执行，与异常通知永远只能执行一个--&gt;</span>
            <span class="nt">&lt;aop:after-returning</span> <span class="na">method=</span><span class="s">"afterReturningPrintLog"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--            异常通知：在切入点方法执行产生异常之后执行，与后置通知永远只能执行一个--&gt;</span>
            <span class="nt">&lt;aop:after-throwing</span> <span class="na">method=</span><span class="s">"afterThrowingPrintLog"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--            最终通知：无论切入点方法是否正常执行，它都会在其后面执行--&gt;</span>
            <span class="nt">&lt;aop:after</span> <span class="na">method=</span><span class="s">"afterPrintLog"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>
				<span class="nt">&lt;/aop:aspect&gt;</span>
</pre></table></code></div></div><h3 id="spring中的环绕通知">Spring中的环绕通知</h3><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">*</span> 当配置了环绕通知之后，切入点方法没有执行，而通知方法执行了。
		通过对比动态代理中的环绕通知代码，发现动态代理的环绕通知有明确的切入点方法调用（method.invoke()），而我们的代码中没有。
		spring框架为我们提供了一个接口，ProceedingJoinPoint。该接口有一个方法proceed()，此方法就相当于明确调用切入点方法。该接口可以作为环绕通知的方法参数，在程序执行时，Spring框架会为我们提供该接口的实现类供我们使用。

环绕通知：它是Spring框架为我们提供的一种可以在代码中手动控制增强方法何时执行的方式。
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="cm">/**
* 环绕通知
*
*/</span>
<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">aroundPrintLog</span><span class="o">(</span><span class="nc">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="o">){</span>
  <span class="nc">Object</span> <span class="n">rtValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="c1">//明确调用业务层方法</span>
  <span class="k">try</span><span class="o">{</span>
    <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">pjp</span><span class="o">.</span><span class="na">getArgs</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"前置通知"</span><span class="o">);</span>
    <span class="n">rtValue</span> <span class="o">=</span> <span class="n">pjp</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"后置通知"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">rtValue</span><span class="o">;</span>
  <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">t</span><span class="o">){</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"异常通知"</span><span class="o">);</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
  <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"最终通知"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="spring基于注解的aop配置">Spring基于注解的AOP配置</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="nd">@Component</span><span class="o">(</span><span class="s">"logger"</span><span class="o">)</span>
<span class="nd">@Aspect</span><span class="c1">//表示当前类是一个切面类</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Logger</span> <span class="o">{</span>

    <span class="nd">@Pointcut</span><span class="o">(</span><span class="s">"execution(* com.yucaihuang.service.impl.*.*(..))"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt1</span><span class="o">(){</span>

    <span class="o">}</span>
    <span class="cm">/**
     *  前置通知
     */</span>
    <span class="c1">//@Before("pt1()")</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforePrintLog</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"前置通知日志执行"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     *  后置通知
     */</span>
    <span class="c1">//@AfterReturning("pt1()")</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterReturningPrintLog</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"后置通知日志执行"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     *  异常通知
     */</span>
    <span class="c1">//@AfterThrowing("pt1()")</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterThrowingPrintLog</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"异常通知日志执行"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//@After("pt1()")</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterPrintLog</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"最终通知日志执行"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 环绕通知
     *
     */</span>
    <span class="nd">@Around</span><span class="o">(</span><span class="s">"pt1()"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">aroundPrintLog</span><span class="o">(</span><span class="nc">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="o">){</span>
        <span class="nc">Object</span> <span class="n">rtValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="c1">//明确调用业务层方法</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">pjp</span><span class="o">.</span><span class="na">getArgs</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"前置通知"</span><span class="o">);</span>
            <span class="n">rtValue</span> <span class="o">=</span> <span class="n">pjp</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"后置通知"</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">rtValue</span><span class="o">;</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">t</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"异常通知"</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"最终通知"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>主配置类<code class="language-plaintext highlighter-rouge">SpringConfiguration.java</code>：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"com.yucaihuang"</span><span class="o">)</span>
<span class="nd">@EnableAspectJAutoProxy</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfiguration</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="spring基于xml的aop事务控制">Spring基于xml的AOP事务控制</h3><p>Bean.xml</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:aop=</span><span class="s">"http://www.springframework.org/schema/aop"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        https://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="nt">&gt;</span>


<span class="c">&lt;!--    &amp;lt;!&amp;ndash;    告知Spring在创建容器时，要扫描的包&amp;ndash;&amp;gt;--&gt;</span>
<span class="c">&lt;!--    &lt;context:component-scan base-package="com.yucaihuang"/&gt;--&gt;</span>
    <span class="c">&lt;!--    配置QueryRunner--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"runner"</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbutils.QueryRunner"</span> <span class="na">scope=</span><span class="s">"prototype"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!--    配置数据源--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--        连接数据库的必备信息--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jdbcUrl"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/eesy_mybatis"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"qazwsxedc7410"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"accountDao"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.dao.impl.AccountDaoImpl"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"runner"</span> <span class="na">ref=</span><span class="s">"runner"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connectionUtils"</span> <span class="na">ref=</span><span class="s">"connectionUtils"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"connectionUtils"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.utils.ConnectionUtils"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"accountService"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.service.impl.AccountServiceImpl"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"accountDao"</span> <span class="na">ref=</span><span class="s">"accountDao"</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!--        &lt;property name="transactionManager" ref="transactionManager"/&gt;--&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"transactionManager"</span> <span class="na">class=</span><span class="s">"com.yucaihuang.utils.TransactionManager"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connectionUtils"</span> <span class="na">ref=</span><span class="s">"connectionUtils"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>


<span class="c">&lt;!--    配置AOP--&gt;</span>
    <span class="nt">&lt;aop:config&gt;</span>
<span class="c">&lt;!--        配置通用切入点表达式--&gt;</span>
        <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">"pt1"</span> <span class="na">expression=</span><span class="s">"execution(* com.yucaihuang.service.impl.*.*(..))"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">"txAdice"</span> <span class="na">ref=</span><span class="s">"transactionManager"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--            配置前置通知：开启事务--&gt;</span>
            <span class="nt">&lt;aop:before</span> <span class="na">method=</span><span class="s">"beginTransaction"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--            配置后置通知：提交事务--&gt;</span>
            <span class="nt">&lt;aop:after-returning</span> <span class="na">method=</span><span class="s">"commit"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--            配置异常通知：回滚事务--&gt;</span>
            <span class="nt">&lt;aop:after-throwing</span> <span class="na">method=</span><span class="s">"rollback"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--            配置最终通知：释放连接--&gt;</span>
            <span class="nt">&lt;aop:after</span> <span class="na">method=</span><span class="s">"release"</span> <span class="na">pointcut-ref=</span><span class="s">"pt1"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;/aop:aspect&gt;</span>
    <span class="nt">&lt;/aop:config&gt;</span>
<span class="nt">&lt;/beans&gt;</span>

</pre></table></code></div></div><h3 id="spring基于注解的aop事务控制">Spring基于注解的AOP事务控制</h3><p>由于Spring框架中，最终通知先于后置通知执行，只能使用环绕通知配置事务控制。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="cm">/**
 * 和事务管理相关的工具类，它包含了：开启事务，提交事务，回滚事务和释放连接
 */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"transactionManager"</span><span class="o">)</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionManager</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ConnectionUtils</span> <span class="n">connectionUtils</span><span class="o">;</span>

    <span class="nd">@Pointcut</span><span class="o">(</span><span class="s">"execution(* com.yucaihuang.service.impl.*.*(..))"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt1</span><span class="o">(){}</span>

    <span class="nd">@Around</span><span class="o">(</span><span class="s">"pt1()"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">aroundAdvice</span><span class="o">(</span><span class="nc">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="o">){</span>
        <span class="nc">Object</span> <span class="n">rtValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">//1.获取参数</span>
            <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">pjp</span><span class="o">.</span><span class="na">getArgs</span><span class="o">();</span>
            <span class="c1">//2.开启事务</span>
            <span class="k">this</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
            <span class="c1">//3.执行方法</span>
            <span class="n">rtValue</span> <span class="o">=</span> <span class="n">pjp</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
            <span class="c1">//4.提交事务</span>
            <span class="k">this</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">rtValue</span><span class="o">;</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">e</span><span class="o">){</span>
            <span class="c1">//5.回滚事务</span>
            <span class="k">this</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//6.释放资源</span>
            <span class="k">this</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/HYCBlog/categories/blogging/'>Blogging</a>, <a href='/HYCBlog/categories/javaweb/'>javaweb</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/HYCBlog/tags/web/" class="post-tag no-text-decoration" >web</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring：AOP（面向切面编程） - 黄玉才的博客&url=www.yucaihuang.com/HYCBlog/posts/web-javaweb-spring_5/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring：AOP（面向切面编程） - 黄玉才的博客&u=www.yucaihuang.com/HYCBlog/posts/web-javaweb-spring_5/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Spring：AOP（面向切面编程） - 黄玉才的博客&url=www.yucaihuang.com/HYCBlog/posts/web-javaweb-spring_5/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/HYCBlog/posts/leetcode-solution_hot_100/">Leetcode题解:Hot 100!</a></li><li><a href="/HYCBlog/posts/leetcode-solution_200_500/">Leetcode题解:200~500</a></li><li><a href="/HYCBlog/posts/point-to-offers/">剑指offer题解</a></li><li><a href="/HYCBlog/posts/leetcode-solution_101_200/">Leetcode题解:101~200</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/HYCBlog/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/">算法题解</a> <a class="post-tag" href="/HYCBlog/tags/java%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">Java源码学习</a> <a class="post-tag" href="/HYCBlog/tags/java/">java</a> <a class="post-tag" href="/HYCBlog/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/HYCBlog/tags/web/">web</a> <a class="post-tag" href="/HYCBlog/tags/security/">security</a> <a class="post-tag" href="/HYCBlog/tags/redis/">redis</a> <a class="post-tag" href="/HYCBlog/tags/jvm/">jvm</a> <a class="post-tag" href="/HYCBlog/tags/concurrency/">concurrency</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/HYCBlog/posts/web-javaweb-mybatis_1/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 4 <i class="unloaded">2020-09-04T19:17:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mybatis：环境搭建</h3><div class="text-muted small"><p> 创建maven工程并导入坐标： &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; ...</p></div></div></a></div><div class="card"> <a href="/HYCBlog/posts/web-javaweb-mybatis_2/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 4 <i class="unloaded">2020-09-04T19:18:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mybatis：入门</h3><div class="text-muted small"><p> 入门案例 public class MybatisTest { public static void main(String[] args) throws IOException { //1.读取配置文件 InputStream in = Resources.getResourceAsStream("SqlMapConfig.xml"); ...</p></div></div></a></div><div class="card"> <a href="/HYCBlog/posts/web-javaweb-mybatis_3/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 4 <i class="unloaded">2020-09-04T19:19:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mybatis：CRUD</h3><div class="text-muted small"><p> 保存操作 在用户Dao接口中定义saveUser抽象方法，用于保存用户： package com.hyc.dao; import com.hyc.domain.User; import org.apache.ibatis.annotations.Select; import java.util.List; /** * 用户的持久层接口 */ public interface I...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/HYCBlog/posts/web-javaweb-spring_4/" class="btn btn-outline-primary"><p>Spring：IOC（控制反转）</p></a> <a href="/HYCBlog/posts/web-javaweb-spring_6/" class="btn btn-outline-primary"><p>Spring：Spring中的JdbcTemplate</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><p class="footer-center"> © 2020 <a href="">Yucai Huang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> <br> <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备2020032055号-1</a></p></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/HYCBlog/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/">算法题解</a> <a class="post-tag" href="/HYCBlog/tags/java%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">Java源码学习</a> <a class="post-tag" href="/HYCBlog/tags/java/">java</a> <a class="post-tag" href="/HYCBlog/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/HYCBlog/tags/web/">web</a> <a class="post-tag" href="/HYCBlog/tags/security/">security</a> <a class="post-tag" href="/HYCBlog/tags/redis/">redis</a> <a class="post-tag" href="/HYCBlog/tags/jvm/">jvm</a> <a class="post-tag" href="/HYCBlog/tags/concurrency/">concurrency</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-176388509-1', 'auto'); ga('send', 'pageview'); </script> <script> (function(e,t,n,i,s,a,c){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)} ;a=t.createElement(i);c=t.getElementsByTagName(i)[0];a.async=true;a.src=s ;c.parentNode.insertBefore(a,c) })(window,document,"galite","script","https://cdn.jsdelivr.net/npm/ga-lite@2/dist/ga-lite.min.js"); galite('create', '{"id"=>"UA-176388509-1", "pv"=>{"enabled"=>false, "proxy_url"=>"", "proxy_endpoint"=>"", "cache"=>true}}', 'auto'); galite('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/HYCBlog/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="www.yucaihuang.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
