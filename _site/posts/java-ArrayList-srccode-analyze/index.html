<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Java源码分析之ArrayList | 黄玉才的博客</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Java源码分析之ArrayList" /><meta name="author" content="Kol Huang" /><meta property="og:locale" content="en_US" /><meta name="description" content="类前注释" /><meta property="og:description" content="类前注释" /><link rel="canonical" href="www.yucaihuang.com/HYCBlog/posts/java-ArrayList-srccode-analyze/" /><meta property="og:url" content="www.yucaihuang.com/HYCBlog/posts/java-ArrayList-srccode-analyze/" /><meta property="og:site_name" content="黄玉才的博客" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-09-16T18:27:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Java源码分析之ArrayList" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Kol Huang" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"www.yucaihuang.com/HYCBlog/posts/java-ArrayList-srccode-analyze/"},"url":"www.yucaihuang.com/HYCBlog/posts/java-ArrayList-srccode-analyze/","author":{"@type":"Person","name":"Kol Huang"},"description":"类前注释","dateModified":"2020-09-16T18:27:00+08:00","datePublished":"2020-09-16T18:27:00+08:00","headline":"Java源码分析之ArrayList","@type":"BlogPosting","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/HYCBlog/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/HYCBlog/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/HYCBlog/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/HYCBlog/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/HYCBlog/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/HYCBlog/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/HYCBlog/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/HYCBlog/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/HYCBlog/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/HYCBlog/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/HYCBlog/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/HYCBlog/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/HYCBlog/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/HYCBlog/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/HYCBlog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/HYCBlog/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/HYCBlog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/HYCBlog/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/HYCBlog/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/HYCBlog/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/HYCBlog/assets/css/post.css"><link rel="stylesheet" href="/HYCBlog/assets/css/post.css"><link rel="preload" as="style" href="/HYCBlog/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/HYCBlog/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176388509-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-176388509-1'); </script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/HYCBlog/assets/js/post.min.js" async></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script> <script src="/HYCBlog/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="http://www.yucaihuang.com" alt="avatar"> <img src="/HYCBlog/assets/img/daliy/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/HYCBlog/">黄玉才的博客</a></div><div class="site-subtitle font-italic">把开源的变成自己的，把自己的变成祖传的!</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/HYCBlog/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/KolinHuang" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['yc_huang97','163.com'].join('@'))" > <i class="fas fa-envelope"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/HYCBlog/"> Posts </a> </span> <span>Java源码分析之ArrayList</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Java源码分析之ArrayList</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 16, 2020, 6:27 PM +0800" > Sep 16 <i class="unloaded">2020-09-16T18:27:00+08:00</i> </span> by <span class="author"> Kol Huang</div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Sep 17, 2020, 2:17 PM +0800" > Sep 17 <i class="unloaded">2020-09-17T14:17:41+08:00</i> </span></div></div><div class="post-content"><h2 id="类前注释">类前注释</h2><p>先看源码开始的一大段注释，基本上把ArrayList的功能和实现介绍了一下：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="o">/**</span>
<span class="nc">Resizable</span><span class="o">-</span><span class="n">array</span> <span class="n">implementation</span> <span class="n">of</span> <span class="n">the</span> <span class="nc">List</span> <span class="kd">interface</span><span class="err">.</span>  <span class="nc">Implements</span>
<span class="n">all</span> <span class="n">optional</span> <span class="n">list</span> <span class="n">operations</span><span class="o">,</span> <span class="n">and</span> <span class="n">permits</span> <span class="n">all</span> <span class="n">elements</span><span class="o">,</span> <span class="n">including</span>
<span class="kc">null</span><span class="o">.</span>  <span class="nc">In</span> <span class="n">addition</span> <span class="n">to</span> <span class="n">implementing</span> <span class="n">the</span> <span class="nc">List</span> <span class="kd">interface</span><span class="err">,</span>
<span class="nc">this</span> <span class="kd">class</span> <span class="nc">provides</span> <span class="n">methods</span> <span class="n">to</span> <span class="n">manipulate</span> <span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">array</span> <span class="n">that</span> <span class="n">is</span>
<span class="n">used</span> <span class="n">internally</span> <span class="n">to</span> <span class="n">store</span> <span class="n">the</span> <span class="n">list</span><span class="o">.</span>  <span class="o">(</span><span class="nc">This</span> <span class="kd">class</span> <span class="nc">is</span> <span class="n">roughly</span> <span class="n">equivalent</span> <span class="n">to</span>
<span class="nc">Vector</span><span class="o">,</span> <span class="n">except</span> <span class="n">that</span> <span class="n">it</span> <span class="n">is</span> <span class="n">unsynchronized</span><span class="o">.)</span>
 <span class="nc">List</span> <span class="n">接口的可调整大小的数组实现</span><span class="err">。</span> <span class="n">实现所有可选的列表操作</span><span class="err">，</span><span class="n">并允许所有元素</span><span class="err">，</span><span class="n">包括null</span><span class="err">。</span>
<span class="n">除了实现List接口之外</span><span class="err">，</span><span class="n">此类还提供一些方法来操纵内部用于存储列表的数组的大小</span><span class="err">。</span> <span class="err">（</span><span class="n">此类与Vector大致等效</span><span class="err">，</span><span class="n">但它是不同步的</span><span class="err">。）</span>
<span class="n">划重点</span><span class="err">！</span><span class="n">可调整大小</span><span class="err">！</span><span class="n">提供了一些方法来操纵数组的大小</span><span class="err">！</span>
 <span class="o">*</span>
<span class="nc">The</span> <span class="n">size</span><span class="o">,</span> <span class="n">isEmpty</span><span class="o">,</span> <span class="n">get</span><span class="o">,</span> <span class="n">set</span><span class="o">,</span>
<span class="n">iterator</span><span class="o">,</span> <span class="n">and</span> <span class="n">listIterator</span> <span class="n">operations</span> <span class="n">run</span> <span class="n">in</span> <span class="n">constant</span>
<span class="n">time</span><span class="o">.</span>  <span class="nc">The</span> <span class="n">add</span> <span class="n">operation</span> <span class="n">runs</span> <span class="n">in</span> <span class="n">amortized</span> <span class="n">constant</span> <span class="n">time</span><span class="o">,</span>
<span class="n">that</span> <span class="n">is</span><span class="o">,</span> <span class="n">adding</span> <span class="n">n</span> <span class="n">elements</span> <span class="n">requires</span> <span class="nf">O</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="n">time</span><span class="o">.</span>  <span class="nc">All</span> <span class="n">of</span> <span class="n">the</span> <span class="n">other</span> <span class="n">operations</span>
<span class="n">run</span> <span class="n">in</span> <span class="n">linear</span> <span class="nf">time</span> <span class="o">(</span><span class="n">roughly</span> <span class="n">speaking</span><span class="o">).</span>  <span class="nc">The</span> <span class="n">constant</span> <span class="n">factor</span> <span class="n">is</span> <span class="n">low</span> <span class="n">compared</span>
<span class="n">to</span> <span class="n">that</span> <span class="k">for</span> <span class="n">the</span> <span class="nc">LinkedList</span> <span class="n">implementation</span><span class="o">.</span>
<span class="n">size</span> <span class="n">isEmpty</span><span class="err">，</span><span class="n">get</span><span class="err">，</span><span class="n">set</span><span class="err">，</span><span class="n">iterator和listIterator方法在恒定时间内运行</span><span class="err">。</span>
 <span class="n">添加方法以固定的时间运行</span><span class="err">，</span><span class="n">也就是说</span><span class="err">，</span><span class="n">添加n个元素需要O</span><span class="err">（</span><span class="n">n</span><span class="err">）</span><span class="n">时间</span><span class="err">。</span> 
 <span class="n">所有其他操作均以线性时间运行</span><span class="err">（</span><span class="n">大致而言</span><span class="err">）。</span> <span class="n">与LinkedList实现相比</span><span class="err">，</span><span class="n">常数因子较低</span><span class="err">。</span>
 <span class="o">*</span>
<span class="nc">Each</span> <span class="nc">ArrayList</span> <span class="n">instance</span> <span class="n">has</span> <span class="n">a</span> <span class="n">capacity</span><span class="o">.</span>  <span class="nc">The</span> <span class="n">capacity</span> <span class="n">is</span>
<span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">array</span> <span class="n">used</span> <span class="n">to</span> <span class="n">store</span> <span class="n">the</span> <span class="n">elements</span> <span class="n">in</span> <span class="n">the</span> <span class="n">list</span><span class="o">.</span>  <span class="nc">It</span> <span class="n">is</span> <span class="n">always</span>
<span class="n">at</span> <span class="n">least</span> <span class="n">as</span> <span class="n">large</span> <span class="n">as</span> <span class="n">the</span> <span class="n">list</span> <span class="n">size</span><span class="o">.</span>  <span class="nc">As</span> <span class="n">elements</span> <span class="n">are</span> <span class="n">added</span> <span class="n">to</span> <span class="n">an</span> <span class="nc">ArrayList</span><span class="o">,</span>
<span class="n">its</span> <span class="n">capacity</span> <span class="n">grows</span> <span class="n">automatically</span><span class="o">.</span>  <span class="nc">The</span> <span class="n">details</span> <span class="n">of</span> <span class="n">the</span> <span class="n">growth</span> <span class="n">policy</span> <span class="n">are</span> <span class="n">not</span>
<span class="n">specified</span> <span class="n">beyond</span> <span class="n">the</span> <span class="n">fact</span> <span class="n">that</span> <span class="n">adding</span> <span class="n">an</span> <span class="n">element</span> <span class="n">has</span> <span class="n">constant</span> <span class="n">amortized</span>
<span class="n">time</span> <span class="n">cost</span><span class="o">.</span>
<span class="n">每个ArrayList实例都有一个容量</span><span class="err">。</span> <span class="n">容量是用于在列表中存储元素的数组的大小</span><span class="err">。</span> 
<span class="n">它总是至少与列表大小一样大</span><span class="err">。</span> <span class="n">将元素添加到ArrayList时</span><span class="err">，</span><span class="n">其容量会自动增长</span><span class="err">。</span>
 <span class="n">除了添加元素具有固定的摊销时间成本外</span><span class="err">，</span><span class="n">没有指定增长策略的详细信息</span><span class="err">。</span>

 <span class="o">*</span>
<span class="nc">An</span> <span class="n">application</span> <span class="n">can</span> <span class="n">increase</span> <span class="n">the</span> <span class="n">capacity</span> <span class="n">of</span> <span class="n">an</span> <span class="nc">ArrayList</span> <span class="n">instance</span>
<span class="n">before</span> <span class="n">adding</span> <span class="n">a</span> <span class="n">large</span> <span class="n">number</span> <span class="n">of</span> <span class="n">elements</span> <span class="n">using</span> <span class="n">the</span> <span class="n">ensureCapacity</span>
<span class="n">operation</span><span class="o">.</span>  <span class="nc">This</span> <span class="n">may</span> <span class="n">reduce</span> <span class="n">the</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">incremental</span> <span class="n">reallocation</span><span class="o">.</span>
<span class="n">应用程序可以通过使用sureCapacity方法在添加大量元素之前增加ArrayList实例的容量</span><span class="err">。</span> <span class="n">这可以减少增量重新分配的数量</span><span class="err">。</span>
<span class="n">sureCapacity这个方法是做什么的</span><span class="err">，</span><span class="n">以及如何做的</span><span class="err">？</span>
 <span class="o">*</span>

<span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="nc">Note</span> <span class="n">that</span> <span class="k">this</span> <span class="n">implementation</span> <span class="n">is</span> <span class="n">not</span> <span class="kd">synchronized</span><span class="o">.&lt;/</span><span class="n">strong</span><span class="o">&gt;</span>
<span class="nc">If</span> <span class="n">multiple</span> <span class="n">threads</span> <span class="n">access</span> <span class="n">an</span> <span class="nc">ArrayList</span> <span class="n">instance</span> <span class="n">concurrently</span><span class="o">,</span>
<span class="n">and</span> <span class="n">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">threads</span> <span class="n">modifies</span> <span class="n">the</span> <span class="n">list</span> <span class="n">structurally</span><span class="o">,</span> <span class="n">it</span>
<span class="n">must</span> <span class="n">be</span> <span class="kd">synchronized</span> <span class="n">externally</span><span class="o">.</span>  <span class="o">(</span><span class="no">A</span> <span class="n">structural</span> <span class="n">modification</span> <span class="n">is</span>
<span class="n">any</span> <span class="n">operation</span> <span class="n">that</span> <span class="n">adds</span> <span class="n">or</span> <span class="n">deletes</span> <span class="n">one</span> <span class="n">or</span> <span class="n">more</span> <span class="n">elements</span><span class="o">,</span> <span class="n">or</span> <span class="n">explicitly</span>
<span class="n">resizes</span> <span class="n">the</span> <span class="n">backing</span> <span class="n">array</span><span class="o">;</span> <span class="n">merely</span> <span class="n">setting</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">an</span> <span class="n">element</span> <span class="n">is</span> <span class="n">not</span>
<span class="n">a</span> <span class="n">structural</span> <span class="n">modification</span><span class="o">.)</span>  <span class="nc">This</span> <span class="n">is</span> <span class="n">typically</span> <span class="n">accomplished</span> <span class="n">by</span>
<span class="n">synchronizing</span> <span class="n">on</span> <span class="n">some</span> <span class="n">object</span> <span class="n">that</span> <span class="n">naturally</span> <span class="n">encapsulates</span> <span class="n">the</span> <span class="n">list</span><span class="o">.</span>
<span class="n">请注意</span><span class="err">，</span><span class="n">此实现未同步</span><span class="err">。</span> <span class="n">如果多个线程同时访问ArrayList实例</span><span class="err">，</span><span class="n">并且至少有一个线程在结构上修改列表</span><span class="err">，</span><span class="n">则必须在外部进行同步</span><span class="err">。</span>
<span class="err">（</span><span class="n">结构修改是添加或删除一个或多个元素或显式调整后备数组大小的任何操作</span><span class="err">；</span><span class="n">仅设置元素的值不是结构修改</span><span class="err">。）</span>
<span class="n">通常</span><span class="err">，</span><span class="n">通过在自然封装列表的某个对象上进行同步来完成此操作</span><span class="err">。</span>


 <span class="o">*</span>
<span class="nc">If</span> <span class="n">no</span> <span class="n">such</span> <span class="n">object</span> <span class="n">exists</span><span class="o">,</span> <span class="n">the</span> <span class="n">list</span> <span class="n">should</span> <span class="n">be</span> <span class="s">"wrapped"</span> <span class="n">using</span> <span class="n">the</span>
<span class="o">{</span><span class="nd">@link</span> <span class="nc">Collections</span><span class="err">#</span><span class="n">synchronizedList</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">}</span>
<span class="n">method</span><span class="o">.</span>  <span class="nc">This</span> <span class="n">is</span> <span class="n">best</span> <span class="n">done</span> <span class="n">at</span> <span class="n">creation</span> <span class="n">time</span><span class="o">,</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">accidental</span>
<span class="n">unsynchronized</span> <span class="n">access</span> <span class="n">to</span> <span class="n">the</span> <span class="nl">list:</span><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;</span>
  <span class="nc">List</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">(...));&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
<span class="n">如果不存在这样的对象</span><span class="err">，</span><span class="n">则应使用</span><span class="o">{</span><span class="nd">@link</span> <span class="nc">Collections</span><span class="err">＃</span><span class="n">synchronizedList</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">}</span><span class="n">方法</span><span class="err">“</span><span class="n">包装</span><span class="err">”</span><span class="n">列表</span><span class="err">。</span>
<span class="n">最好在创建时完成此操作</span><span class="err">，</span><span class="n">以防止意外的不同步访问列表</span><span class="err">：</span>
<span class="nc">List</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">(...));</span>
<span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">()</span><span class="n">方法研究一下</span>

 <span class="o">*</span>
 <span class="o">&lt;</span><span class="n">a</span> <span class="n">name</span><span class="o">=</span><span class="s">"fail-fast"</span><span class="o">&gt;</span>
 <span class="nc">The</span> <span class="n">iterators</span> <span class="n">returned</span> <span class="n">by</span> <span class="k">this</span> <span class="kd">class</span><span class="err">'</span><span class="nc">s</span> <span class="o">{</span><span class="nd">@link</span> <span class="err">#</span><span class="n">iterator</span><span class="o">()</span> <span class="n">iterator</span><span class="o">}</span> <span class="n">and</span>
 <span class="o">{</span><span class="nd">@link</span> <span class="err">#</span><span class="n">listIterator</span><span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">listIterator</span><span class="o">}</span> <span class="n">methods</span> <span class="n">are</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">fail</span><span class="o">-</span><span class="n">fast</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;:&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
 <span class="k">if</span> <span class="n">the</span> <span class="n">list</span> <span class="n">is</span> <span class="n">structurally</span> <span class="n">modified</span> <span class="n">at</span> <span class="n">any</span> <span class="n">time</span> <span class="n">after</span> <span class="n">the</span> <span class="n">iterator</span> <span class="n">is</span>
 <span class="n">created</span><span class="o">,</span> <span class="n">in</span> <span class="n">any</span> <span class="n">way</span> <span class="n">except</span> <span class="n">through</span> <span class="n">the</span> <span class="n">iterator</span><span class="err">'</span><span class="n">s</span> <span class="n">own</span>
 <span class="o">{</span><span class="nd">@link</span> <span class="nc">ListIterator</span><span class="err">#</span><span class="n">remove</span><span class="o">()</span> <span class="n">remove</span><span class="o">}</span> <span class="n">or</span>
 <span class="o">{</span><span class="nd">@link</span> <span class="nc">ListIterator</span><span class="err">#</span><span class="n">add</span><span class="o">(</span><span class="nc">Object</span><span class="o">)</span> <span class="n">add</span><span class="o">}</span> <span class="n">methods</span><span class="o">,</span> <span class="n">the</span> <span class="n">iterator</span> <span class="n">will</span> <span class="k">throw</span> <span class="n">a</span>
 <span class="o">{</span><span class="nd">@link</span> <span class="nc">ConcurrentModificationException</span><span class="o">}.</span>  <span class="nc">Thus</span><span class="o">,</span> <span class="n">in</span> <span class="n">the</span> <span class="n">face</span> <span class="n">of</span>
 <span class="n">concurrent</span> <span class="n">modification</span><span class="o">,</span> <span class="n">the</span> <span class="n">iterator</span> <span class="n">fails</span> <span class="n">quickly</span> <span class="n">and</span> <span class="n">cleanly</span><span class="o">,</span> <span class="n">rather</span>
 <span class="n">than</span> <span class="n">risking</span> <span class="n">arbitrary</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">deterministic</span> <span class="n">behavior</span> <span class="n">at</span> <span class="n">an</span> <span class="n">undetermined</span>
 <span class="n">time</span> <span class="n">in</span> <span class="n">the</span> <span class="n">future</span><span class="o">.</span>
 <span class="n">在创建迭代器之后的任何时间如果列表在结构上有任何修改</span><span class="err">，</span>
<span class="n">则此类的</span><span class="o">{</span><span class="nd">@link</span> <span class="err">#</span><span class="n">iterator</span><span class="err">（）</span><span class="n">迭代器</span><span class="o">}</span><span class="n">和</span><span class="o">{</span><span class="nd">@link</span> <span class="err">#</span><span class="n">listIterator</span><span class="err">（</span><span class="kt">int</span><span class="err">）</span><span class="n">listIterator</span><span class="o">}</span><span class="n">方法返回的迭代器会fail</span><span class="o">-</span><span class="n">fast</span><span class="err">。</span>
<span class="n">除了通过迭代器自己的</span><span class="o">{</span><span class="nd">@link</span> <span class="nc">ListIterator</span><span class="err">＃</span><span class="n">remove</span><span class="err">（）</span><span class="n">remove</span><span class="o">}</span><span class="n">或</span><span class="o">{</span><span class="nd">@link</span> <span class="nc">ListIterator</span><span class="err">＃</span><span class="n">add</span><span class="err">（</span><span class="nc">Object</span><span class="err">）</span><span class="n">add</span><span class="o">}</span><span class="n">方法</span><span class="err">）</span><span class="n">之外</span><span class="err">，</span>
<span class="n">迭代器都会抛出</span><span class="o">{</span><span class="nd">@link</span> <span class="nc">ConcurrentModificationException</span><span class="o">}</span><span class="err">。</span> 
<span class="n">因此</span><span class="err">，</span><span class="n">面对并发修改</span><span class="err">，</span><span class="n">迭代器会快速抛出异常</span><span class="err">，</span><span class="n">不会冒任何风险</span><span class="err">。</span>

 <span class="o">*</span>
<span class="nc">Note</span> <span class="n">that</span> <span class="n">the</span> <span class="n">fail</span><span class="o">-</span><span class="n">fast</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">an</span> <span class="n">iterator</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">guaranteed</span>
<span class="n">as</span> <span class="n">it</span> <span class="n">is</span><span class="o">,</span> <span class="n">generally</span> <span class="n">speaking</span><span class="o">,</span> <span class="n">impossible</span> <span class="n">to</span> <span class="n">make</span> <span class="n">any</span> <span class="n">hard</span> <span class="n">guarantees</span> <span class="n">in</span> <span class="n">the</span>
<span class="n">presence</span> <span class="n">of</span> <span class="n">unsynchronized</span> <span class="n">concurrent</span> <span class="n">modification</span><span class="o">.</span>  <span class="nc">Fail</span><span class="o">-</span><span class="n">fast</span> <span class="n">iterators</span>
<span class="k">throw</span> <span class="o">{</span><span class="nd">@code</span> <span class="nc">ConcurrentModificationException</span><span class="o">}</span> <span class="n">on</span> <span class="n">a</span> <span class="n">best</span><span class="o">-</span><span class="n">effort</span> <span class="n">basis</span><span class="o">.</span>
<span class="nc">Therefore</span><span class="o">,</span> <span class="n">it</span> <span class="n">would</span> <span class="n">be</span> <span class="n">wrong</span> <span class="n">to</span> <span class="n">write</span> <span class="n">a</span> <span class="n">program</span> <span class="n">that</span> <span class="n">depended</span> <span class="n">on</span> <span class="k">this</span>
<span class="n">exception</span> <span class="k">for</span> <span class="n">its</span> <span class="nl">correctness:</span>  <span class="n">the</span> <span class="n">fail</span><span class="o">-</span><span class="n">fast</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">iterators</span>
<span class="n">should</span> <span class="n">be</span> <span class="n">used</span> <span class="n">only</span> <span class="n">to</span> <span class="n">detect</span> <span class="n">bugs</span><span class="o">.</span>

<span class="n">注意</span><span class="err">，</span><span class="n">不能保证迭代器的快速失败行为</span><span class="err">，</span>
<span class="n">因为通常来说</span><span class="err">，</span><span class="n">在存在不同步的并发修改的情况下</span><span class="err">，</span><span class="n">不可能做出任何严格的保证</span><span class="err">。</span>
<span class="n">快速失败的迭代器会尽最大努力抛出</span><span class="o">{</span><span class="nd">@code</span> <span class="nc">ConcurrentModificationException</span><span class="o">}</span><span class="err">。</span> 
<span class="n">因此</span><span class="err">，</span><span class="n">编写依赖于此异常的程序的正确性是错误的</span><span class="err">：</span><span class="n">迭代器的快速失败行为应仅用于检测错误</span><span class="err">。</span>
<span class="n">就是说不能依赖这个异常来编写任何相关判断性的程序片段</span><span class="err">，</span><span class="n">这个异常的行为是不确定的</span><span class="err">，</span><span class="n">有可能发生了结构性修改</span><span class="err">，</span><span class="n">但是没有抛出异常</span><span class="err">。</span>
</pre></table></code></div></div><p>从上面的注释可以看出几个要点：</p><ul><li><p>ArrayList通过一些方法来调整数组的大小。</p></li><li><p>添加n个元素需要<code class="language-plaintext highlighter-rouge">O(n)</code>的时间。<code class="language-plaintext highlighter-rouge">size(),isEmpty(),get(),set(),iterator()和listIterator()</code>方法在恒定时间内运行。与LinkedList实现相比，常数因子较低。</p></li><li><p>应用程序可以通过使用sureCapacity方法在添加<strong>大量元素</strong>之前增加ArrayList实例的容量。 这可以减少<strong>增量重新分配的数量。</strong></p></li><li><p>这个容器实现是非同步的，如果多个线程访问ArrayList实例，就需要在外部进行同步。可以用下面这种方法：</p><ul><li><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">List</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">(...));</span>
</pre></table></code></div></div></li></ul></li><li><p>在<strong>创建迭代器之后</strong>，出了迭代器自带的<code class="language-plaintext highlighter-rouge">remove</code>和<code class="language-plaintext highlighter-rouge">add</code>方法之外，<strong>其他对列表有任何结构性修改的行为</strong>都会导致程序抛出<code class="language-plaintext highlighter-rouge">ConcurrentModificationException</code>异常。但是不能保证一定会抛出这个异常，所以不能根据这个异常来编写任何判断性的程序片段。</p></li></ul><h2 id="变量">变量</h2><p>这个类开头定义了如下变量（部分）：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">8683452581122892189L</span><span class="o">;</span>
<span class="c1">//初始化时的默认容量。</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DEFAULT_CAPACITY</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
<span class="c1">//用于空实例的共享空数组实例。这个没懂是啥</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Object</span><span class="o">[]</span> <span class="no">EMPTY_ELEMENTDATA</span> <span class="o">=</span> <span class="o">{};</span>


<span class="c1">//共享的空数组实例，用于默认大小的空实例。 我们将此与EMPTY_ELEMENTDATA区别开来，以了解添加第一个元素时需要膨胀多少。</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Object</span><span class="o">[]</span> <span class="no">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span> <span class="o">=</span> <span class="o">{};</span>

<span class="cm">/**
存储ArrayList元素的数组缓冲区。ArrayList的容量是此数组缓冲区的长度。 
添加第一个元素时，任何具有elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA的空ArrayList
都将扩展为DEFAULT_CAPACITY。
*/</span>
<span class="kd">transient</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">elementData</span><span class="o">;</span> <span class="c1">//非私有以简化嵌套类访问</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
</pre></table></code></div></div><p>几个要点：</p><ul><li>当初始化时未指定容量，默认的容量为10。</li><li><code class="language-plaintext highlighter-rouge">EMPTY_ELEMENTDATA</code>用于有参构造器，参数为0的初始化；<code class="language-plaintext highlighter-rouge">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code>用于无参构造器的初始化。</li><li><code class="language-plaintext highlighter-rouge">elementData</code>定义为非私有，来简化嵌套类的访问。这边使用了关键字<code class="language-plaintext highlighter-rouge">transient</code>。简单地介绍一下：<ul><li>一旦变量被transient修饰，变量将不再是对象持久化的一部分，该变量内容在序列化后无法获得访问。</li><li>transient关键字<strong>只能修饰变量，而</strong>不能修饰方法和类。注意，本地变量是不能被transient关键字修饰的。变量如果是用户自定义类变量，则该类需要实现Serializable接口。</li><li>被transient关键字修饰的变量不再能被序列化，一个静态变量不管是否被transient修饰，均不能被序列化。</li><li>在Java中，对象的序列化可以通过实现两种接口来实现，若实现<strong>的是Serializable接口，</strong>则所有的序列化将<strong>会自动进行</strong>，若实现的是<strong>Externalizable接口</strong>，则没有任何东西可以自动序列化，<strong>需要在writeExternal方法中进行手工指定所要序列化的变量</strong>，<strong>这与是否被transient修饰无关。</strong></li></ul></li></ul><h3 id="关于modcount变量">关于modCount变量</h3><p>几乎在所有线程不安全的容器中都有这么一个变量<code class="language-plaintext highlighter-rouge">modCount</code>，记录了修改容器结构的操作次数。例如在ArrayList中，modCount在迭代器实现中使用：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="cm">/**
     * An optimized version of AbstractList.Itr
     */</span>
<span class="kd">private</span> <span class="kd">class</span> <span class="nc">Itr</span> <span class="kd">implements</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">cursor</span><span class="o">;</span>       <span class="c1">// index of next element to return</span>
    <span class="kt">int</span> <span class="n">lastRet</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="c1">// index of last element returned; -1 if no such</span>
    <span class="kt">int</span> <span class="n">expectedModCount</span> <span class="o">=</span> <span class="n">modCount</span><span class="o">;</span>

    <span class="nc">Itr</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">cursor</span> <span class="o">!=</span> <span class="n">size</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="no">E</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">checkForComodification</span><span class="o">();</span>
      <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NoSuchElementException</span><span class="o">();</span>
      <span class="nc">Object</span><span class="o">[]</span> <span class="n">elementData</span> <span class="o">=</span> <span class="nc">ArrayList</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">elementData</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">elementData</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConcurrentModificationException</span><span class="o">();</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
      <span class="k">return</span> <span class="o">(</span><span class="no">E</span><span class="o">)</span> <span class="n">elementData</span><span class="o">[</span><span class="n">lastRet</span> <span class="o">=</span> <span class="n">i</span><span class="o">];</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">lastRet</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">();</span>
      <span class="n">checkForComodification</span><span class="o">();</span>

      <span class="k">try</span> <span class="o">{</span>
        <span class="nc">ArrayList</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">lastRet</span><span class="o">);</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">lastRet</span><span class="o">;</span>
        <span class="n">lastRet</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="n">expectedModCount</span> <span class="o">=</span> <span class="n">modCount</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IndexOutOfBoundsException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConcurrentModificationException</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forEachRemaining</span><span class="o">(</span><span class="nc">Consumer</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">consumer</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">consumer</span><span class="o">);</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="nc">ArrayList</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
      <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="kd">final</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">elementData</span> <span class="o">=</span> <span class="nc">ArrayList</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">elementData</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">elementData</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConcurrentModificationException</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="n">modCount</span> <span class="o">==</span> <span class="n">expectedModCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">accept</span><span class="o">((</span><span class="no">E</span><span class="o">)</span> <span class="n">elementData</span><span class="o">[</span><span class="n">i</span><span class="o">++]);</span>
      <span class="o">}</span>
      <span class="c1">// update once at end of iteration to reduce heap write traffic</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
      <span class="n">lastRet</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
      <span class="n">checkForComodification</span><span class="o">();</span>
  <span class="o">}</span>
	<span class="c1">//重点关注这个方法，这个迭代器类中的所有方法都调用此方法</span>
  <span class="kd">final</span> <span class="kt">void</span> <span class="nf">checkForComodification</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">modCount</span> <span class="o">!=</span> <span class="n">expectedModCount</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConcurrentModificationException</span><span class="o">();</span>
      <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>从上面的源码可以看出，迭代器类所有的方法都调用了同一个方法<code class="language-plaintext highlighter-rouge">checkForComodification()</code>，在这个方法中，比较了修改的次数和期望修改的次数是否相等<code class="language-plaintext highlighter-rouge">modCount != expectedModCount</code>。如果在迭代过程中，有其他线程修改了此容器，那么modCount肯定会增加，那么就会造成二者次数不相等，进而会快速的抛出异常，也就是Fail-Fast机制。</p><p>此外，在本迭代器中的remove方法会修改<code class="language-plaintext highlighter-rouge">modCount</code>，但是会紧接着将二者同步<code class="language-plaintext highlighter-rouge">expectedModCount=modCount</code>，以保证下一次调用<code class="language-plaintext highlighter-rouge">checkForComodification</code>方法时，不会抛出异常。</p><h2 id="构造器">构造器</h2><p>三种构造器，</p><ol><li><p>无参构造：初始化数组为默认的空数组</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nf">ArrayList</span><span class="o">()</span> <span class="o">{</span>
  	<span class="k">this</span><span class="o">.</span><span class="na">elementData</span> <span class="o">=</span> <span class="no">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div></li><li><p>整型的有参构造：根据传入的参数，初始化指定长度的数组</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nf">ArrayList</span><span class="o">(</span><span class="kt">int</span> <span class="n">initialCapacity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">initialCapacity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">elementData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">initialCapacity</span><span class="o">];</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">initialCapacity</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">elementData</span> <span class="o">=</span> <span class="no">EMPTY_ELEMENTDATA</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Illegal Capacity: "</span><span class="o">+</span>
                                         <span class="n">initialCapacity</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></li><li><p>Collection类型的有参构造。这里有一个官方的bug，toArray()返回的不一定是<code class="language-plaintext highlighter-rouge">Object[]</code>类型。所以可能还需要下面的<code class="language-plaintext highlighter-rouge">Arrays.copyOf</code>操作</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nf">ArrayList</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">elementData</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span>
  	<span class="c1">//collection长度不为空</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">size</span> <span class="o">=</span> <span class="n">elementData</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">elementData</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
        <span class="n">elementData</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="c1">// replace with empty array.</span>
      <span class="k">this</span><span class="o">.</span><span class="na">elementData</span> <span class="o">=</span> <span class="no">EMPTY_ELEMENTDATA</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></li></ol><h3 id="官方的bug">官方的Bug</h3><blockquote><p>c.toArray might (incorrectly) not return Object[] (see 6260652)</p><p>为什么toArray()方法不一定返回的就是Object[]类型呢？</p></blockquote><p>看如下代码：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//通过ArrayList的toArray()传过来的数组一定是Object[]类型的</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"list"</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//输出class java.util.ArrayList</span>
    <span class="nc">Object</span><span class="o">[]</span> <span class="n">listArray</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">listArray</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//输出class [Ljava.lang.Object;</span>
    <span class="n">listArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
    <span class="c1">//调用Arrays.asList()返回一个列表，当调用这个列表的toArray()方法时，返回的就是String[]类型</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">al</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"asList"</span><span class="o">);</span>
  	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">al</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//输出class java.util.Arrays$ArrayList</span>
    <span class="nc">Object</span><span class="o">[]</span> <span class="n">asListArray</span> <span class="o">=</span> <span class="n">al</span><span class="o">.</span><span class="na">toArray</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">asListArray</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//输出class [Ljava.lang.String;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>这是因为在创建子类实例时，即使是父亲引用，其指向的实例依旧是子类实例，其调用的实例方法当然是子类的实例方法。所以我们看到<code class="language-plaintext highlighter-rouge">al</code>对象的类型是<code class="language-plaintext highlighter-rouge">java.util.Arrays$ArrayList</code>，属于<code class="language-plaintext highlighter-rouge">java.util.Arrays</code>的一个静态内部类，从源码里找这个内部类的<code class="language-plaintext highlighter-rouge">toArray()</code>方法是如何实现的：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">AbstractList</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span>
  <span class="kd">implements</span> <span class="nc">RandomAccess</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span>
<span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2764017481108945198L</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="no">E</span><span class="o">[]</span> <span class="n">a</span><span class="o">;</span>
	<span class="o">...</span>
    <span class="c1">//之前纠结了半天这里为什么传入String类型也可以，因为单个String可以作为一个元素的String[]数组。原因可以看Arrays.asList()方法</span>
    <span class="nc">ArrayList</span><span class="o">(</span><span class="no">E</span><span class="o">[]</span> <span class="n">array</span><span class="o">)</span> <span class="o">{</span>
    	<span class="n">a</span> <span class="o">=</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">array</span><span class="o">);</span>
  	<span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Object</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">()</span> <span class="o">{</span>
      	<span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="no">T</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">)</span>
          <span class="k">return</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span>
                               <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">[]&gt;)</span> <span class="n">a</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">size</span><span class="o">)</span>
          <span class="n">a</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><p>这里的<code class="language-plaintext highlighter-rouge">toArray()</code>方法返回的是对象<code class="language-plaintext highlighter-rouge">a</code>的克隆，对象a的类型是<code class="language-plaintext highlighter-rouge">E[]</code>，和实例化这个内部类时传入的参数类型一致。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">//传入了数量可变的参数，下面都作为数组传入ArrayList构造器中</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">asList</span><span class="o">(</span><span class="no">T</span><span class="o">...</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span><span class="c1">//源码中，参数名是a，为了跟内部类中的数组a区分，我把它改为arg</span>
  	<span class="c1">//在调用asList的时候，会实例化Arrays$ArrayList内部类</span>
  	<span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">arg</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>当调用<code class="language-plaintext highlighter-rouge">asList</code>方法的时候，会实例化上面那个<code class="language-plaintext highlighter-rouge">Arrays$ArrayList</code>内部类得到对象<code class="language-plaintext highlighter-rouge">obj</code>，如果传入的参数<code class="language-plaintext highlighter-rouge">arg</code>是<code class="language-plaintext highlighter-rouge">String</code>类型，那么<code class="language-plaintext highlighter-rouge">obj</code>中的数组<code class="language-plaintext highlighter-rouge">a</code>类型就会是<code class="language-plaintext highlighter-rouge">String[]</code>。因为这个内部类中的<code class="language-plaintext highlighter-rouge">toArray()</code>方法返回的是对象<code class="language-plaintext highlighter-rouge">a</code>的克隆，对象a的类型是<code class="language-plaintext highlighter-rouge">E[]</code>，进而导致在调用<code class="language-plaintext highlighter-rouge">obj</code>的<code class="language-plaintext highlighter-rouge">toArray()</code>方法时，返回的数组类型是<code class="language-plaintext highlighter-rouge">String[]</code>。</p><p><strong>总而言之，</strong>就是<code class="language-plaintext highlighter-rouge">Arrrays</code>类中的静态内部类<code class="language-plaintext highlighter-rouge">ArrayList</code>实现的<code class="language-plaintext highlighter-rouge">toArray()</code>方法返回的数组类型不一定是<code class="language-plaintext highlighter-rouge">Object[]</code>类型，取决于调用<code class="language-plaintext highlighter-rouge">Arrays.asList(T... arg)</code>时，传入参数的类型。</p><h2 id="扩容方法">扩容方法</h2><p>遇到的第一个扩容情形，<code class="language-plaintext highlighter-rouge">ensureCapacity()</code>方法。在应用程序需要添加大量数据的时候，可以调用此方法，来增加实例容量，这样可以减少自动扩容时，增量重新分配的数量。</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">(</span><span class="kt">int</span> <span class="n">minCapacity</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">minExpand</span> <span class="o">=</span> <span class="o">(</span><span class="n">elementData</span> <span class="o">!=</span> <span class="no">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span class="o">)</span>
      <span class="c1">// 数组当前不为空就赋值为0，保证后续能够扩容成功。</span>
      <span class="o">?</span> <span class="mi">0</span>
      <span class="c1">// 当前就是个空数组，那么赋值为DEFAULT_CAPACITY，保证第一次初始化，容量不会小于10</span>
      <span class="o">:</span> <span class="no">DEFAULT_CAPACITY</span><span class="o">;</span>
    <span class="c1">//要求的最小容量大于当前容量，就显式扩容</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">minCapacity</span> <span class="o">&gt;</span> <span class="n">minExpand</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ensureExplicitCapacity</span><span class="o">(</span><span class="n">minCapacity</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">ensureCapacity()</code>方法调用了<code class="language-plaintext highlighter-rouge">ensureExplicitCapacity()</code>方法来明确扩容需求：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureExplicitCapacity</span><span class="o">(</span><span class="kt">int</span> <span class="n">minCapacity</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">modCount</span><span class="o">++;</span>
    <span class="c1">// overflow-conscious code</span>
  	<span class="c1">//要求的最小容量必须大于当前数组长度才能扩容</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">minCapacity</span> <span class="o">-</span> <span class="n">elementData</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="n">grow</span><span class="o">(</span><span class="n">minCapacity</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>继续调用<code class="language-plaintext highlighter-rouge">grow()</code>方法，扩容的代码就写在<code class="language-plaintext highlighter-rouge">grow()</code>方法中：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cm">/**
* Increases the capacity to ensure that it can hold at least the
* number of elements specified by the minimum capacity argument.
*
* @param minCapacity the desired minimum capacity
*/</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">grow</span><span class="o">(</span><span class="kt">int</span> <span class="n">minCapacity</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// overflow-conscious code</span>
    <span class="kt">int</span> <span class="n">oldCapacity</span> <span class="o">=</span> <span class="n">elementData</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
  	<span class="c1">//增量为旧容量扩大一半</span>
    <span class="kt">int</span> <span class="n">newCapacity</span> <span class="o">=</span> <span class="n">oldCapacity</span> <span class="o">+</span> <span class="o">(</span><span class="n">oldCapacity</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="o">);</span>
    <span class="c1">//如果还不够，就直接赋值为指定大小</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">newCapacity</span> <span class="o">-</span> <span class="n">minCapacity</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="n">newCapacity</span> <span class="o">=</span> <span class="n">minCapacity</span><span class="o">;</span>
  	<span class="c1">//如果新容量的大小大于最大数组长度，就赋值为可用的最大容量。</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">newCapacity</span> <span class="o">-</span> <span class="no">MAX_ARRAY_SIZE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="n">newCapacity</span> <span class="o">=</span> <span class="n">hugeCapacity</span><span class="o">(</span><span class="n">minCapacity</span><span class="o">);</span>
    <span class="c1">// minCapacity is usually close to size, so this is a win:</span>
  	<span class="c1">//将数组中的数据复制到扩容后的数组中</span>
    <span class="n">elementData</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="n">newCapacity</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">grow()</code>方法会将数组的大小扩大到<strong>原来的1.5倍。</strong></p><h2 id="克隆方法">克隆方法</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="cm">/**
     * Returns a shallow copy of this ArrayList instance.  (The
     * elements themselves are not copied.)
     *
     仅对列表进行浅拷贝，只拷贝了一个列表实例，列表内的元素没有被拷贝，还是原来的元素
     * @return a clone of this ArrayList instance
     */</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
          	<span class="c1">//此类实现了Cloneable接口，因此可以使用super.clone()方法</span>
            <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span><span class="o">&lt;?&gt;</span> <span class="n">v</span> <span class="o">=</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span><span class="o">&lt;?&gt;)</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
            <span class="n">v</span><span class="o">.</span><span class="na">elementData</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
            <span class="n">v</span><span class="o">.</span><span class="na">modCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">v</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">CloneNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// this shouldn't happen, since we are Cloneable</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InternalError</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>做一组实验，在列表中存放一组对象，然后拷贝一次列表，紧接着对原列表中的对象属性进行修改，查看新列表中的对象属性是否跟着被更改了：</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Node</span><span class="o">{</span>
    <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="nc">Node</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Node{"</span> <span class="o">+</span>
                <span class="s">"name='"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">'\''</span> <span class="o">+</span>
                <span class="sc">'}'</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main1</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      	<span class="c1">//原列表</span>
        <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Node</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
      	<span class="c1">//存入两个Node对象</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="s">"111"</span><span class="o">));</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="s">"222"</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
      	<span class="c1">//调用clone方法</span>
        <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Node</span><span class="o">&gt;</span> <span class="n">cplist</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Node</span><span class="o">&gt;)</span> <span class="n">list</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cplist</span><span class="o">);</span>
      	<span class="c1">//修改原列表中的对象属性</span>
        <span class="nc">Node</span> <span class="n">node</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">node</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">"修改了"</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cplist</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>上面的程序输出：</p><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>[Node{name='111'}, Node{name='222'}]
[Node{name='111'}, Node{name='222'}]
[Node{name='111'}, Node{name='222'}]
[Node{name='修改了'}, Node{name='222'}]
[Node{name='修改了'}, Node{name='222'}]	//修改原列表中对象时，新列表中的对象也被修改了
</pre></table></code></div></div><p>由此得出，这个clone方法只是拷贝了一个列表的实例，列表内的元素没有被拷贝。</p><h2 id="转数组的两种方法">转数组的两种方法</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="cm">/**
第一种方法，返回object数组
* Returns an array containing all of the elements in this list
* in proper sequence (from first to last element).
可以安全的修改返回的数组，无需担心会改变列表的内容。
* This method acts as bridge between array-based and collection-based
* APIs.
*/</span>
<span class="kd">public</span> <span class="nc">Object</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">()</span> <span class="o">{</span>
  	<span class="k">return</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 第二种方法，返回指定数组类型
两种情况:
1. 传入的参数数组长度大于当前列表的长度，那么返回的数组的剩余部分会被填充为null
2. 传入的参数数组长度小于当前列表的长度，那么返回的数组长度会跟列表长度相等。
  */</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
<span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="no">T</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">)</span>
      <span class="c1">// Make a new array of a's runtime type, but my contents:</span>
      <span class="c1">//调用Arrays.copyOf()方法，返回指定类型的数组</span>
      <span class="k">return</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">size</span><span class="o">)</span>
      <span class="n">a</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">//可以跟进去看看Arrays.copyOf如何实现的</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">,</span><span class="no">U</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">copyOf</span><span class="o">(</span><span class="no">U</span><span class="o">[]</span> <span class="n">original</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newLength</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">[]&gt;</span> <span class="n">newType</span><span class="o">)</span> <span class="o">{</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
  	<span class="c1">//先判断是否是object类型，如果不是，就用Array.newInstance创建一个指定类型和长度的数组</span>
    <span class="no">T</span><span class="o">[]</span> <span class="n">copy</span> <span class="o">=</span> <span class="o">((</span><span class="nc">Object</span><span class="o">)</span><span class="n">newType</span> <span class="o">==</span> <span class="o">(</span><span class="nc">Object</span><span class="o">)</span><span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
      <span class="o">?</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">newLength</span><span class="o">]</span>
      <span class="o">:</span> <span class="o">(</span><span class="no">T</span><span class="o">[])</span> <span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">newType</span><span class="o">.</span><span class="na">getComponentType</span><span class="o">(),</span> <span class="n">newLength</span><span class="o">);</span>
  	<span class="c1">//将原数组拷贝进新数组，</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">original</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">copy</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span>
                     <span class="nc">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">original</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">newLength</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>这段代码中使用了一个方法：<code class="language-plaintext highlighter-rouge">System.arraycopy()</code>。之前没见过这个方法，查查看：</p><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>是System类下的一个静态方法。
public static void arraycopy(Object src, int srcPos, Object dest, int destPos, int length)
src:源数组;
srcPos:源数组要复制的起始位置;
dest:目的数组;
destPos:目的数组放置的起始位置;
length:复制的长度.
当length大于src.length - srcPos，即可复制的有效长度时，会抛出ArrayIndexOutOfBoundsException。
当length大于des.length - destPos时，即可存放的有效长度时，也会抛出ArrayIndexOutOfBoundsException。
话说这个拷贝是深拷贝吗？也是浅拷贝，数组内的对象没有被拷贝一份，只是拷贝引用。
</pre></table></code></div></div><h2 id="4种删除方法">4种删除方法</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="no">E</span> <span class="nf">remove</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">rangeCheck</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>

    <span class="n">modCount</span><span class="o">++;</span>
    <span class="no">E</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">elementData</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">numMoved</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">numMoved</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="c1">//从索引位置开始，整体前移</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">elementData</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span>
                       <span class="n">numMoved</span><span class="o">);</span>
    <span class="c1">//释放最后一个位置的引用，让GC回收它</span>
    <span class="n">elementData</span><span class="o">[--</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// clear to let GC do its work</span>

    <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">//删除索引值最低的匹配元素，不存在则返回false</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">index</span><span class="o">++)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elementData</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">fastRemove</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
          <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">index</span><span class="o">++)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">elementData</span><span class="o">[</span><span class="n">index</span><span class="o">]))</span> <span class="o">{</span>
          <span class="n">fastRemove</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
          <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">//私有的删除方法，不检查边界，不返回移除的元素，即快速删除</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">fastRemove</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">modCount</span><span class="o">++;</span>
    <span class="kt">int</span> <span class="n">numMoved</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">numMoved</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">elementData</span><span class="o">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">elementData</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span>
                       <span class="n">numMoved</span><span class="o">);</span>
    <span class="n">elementData</span><span class="o">[--</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// clear to let GC do its work</span>
<span class="o">}</span>

<span class="c1">//删除所有元素</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">modCount</span><span class="o">++;</span>
    <span class="c1">// clear to let GC do its work</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
      <span class="n">elementData</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/HYCBlog/categories/blogging/'>Blogging</a>, <a href='/HYCBlog/categories/%E5%AE%B9%E5%99%A8/'>容器</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/HYCBlog/tags/java%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" class="post-tag no-text-decoration" >Java源码学习</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Java源码分析之ArrayList - 黄玉才的博客&url=www.yucaihuang.com/HYCBlog/posts/java-ArrayList-srccode-analyze/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Java源码分析之ArrayList - 黄玉才的博客&u=www.yucaihuang.com/HYCBlog/posts/java-ArrayList-srccode-analyze/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Java源码分析之ArrayList - 黄玉才的博客&url=www.yucaihuang.com/HYCBlog/posts/java-ArrayList-srccode-analyze/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/HYCBlog/posts/leetcode-solutions/">Leetcode题解:500-1000</a></li><li><a href="/HYCBlog/posts/point-to-offers/">剑指offer题解</a></li><li><a href="/HYCBlog/posts/web-object-concepte/">VO/DTO/DO/PO/POJO/JavaBean的区别</a></li><li><a href="/HYCBlog/posts/algorithm-union-find/">并查集</a></li><li><a href="/HYCBlog/posts/algorithm-manacher/">Manacher算法：线性时间内找到最大回文子串</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/HYCBlog/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/">算法题解</a> <a class="post-tag" href="/HYCBlog/tags/java%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">Java源码学习</a> <a class="post-tag" href="/HYCBlog/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/HYCBlog/tags/web/">web</a> <a class="post-tag" href="/HYCBlog/tags/security/">security</a> <a class="post-tag" href="/HYCBlog/tags/java/">java</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/HYCBlog/posts/priority-queue-src-code-analyze/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 28 <i class="unloaded">2020-08-28T21:03:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>从算法到源码：PriorityQueue源码学习</h3><div class="text-muted small"><p> 剑指 Offer 41. 数据流中的中位数 如何得到一个数据流中的中位数？如果从数据流中读出奇数个数值，那么中位数就是所有数值排序之后位于中间的数值。如果从数据流中读出偶数个数值，那么中位数就是所有数值排序之后中间两个数的平均值。 例如， [2,3,4] 的中位数是 3 [2,3] 的中位数是 (2 + 3) / 2 = 2.5 设计一个支持以下两种操作的数据结构： voi...</p></div></div></a></div><div class="card"> <a href="/HYCBlog/posts/web-docker_2/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 7 <i class="unloaded">2020-09-07T19:38:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Docker：入门</h3><div class="text-muted small"><p> Docker安装 环境准备 CentOS 7 环境查看 #系统内核是 3.10以上的 # uname -r 3.10.0-514.26.2.el7.x86_64 #系统版本 # cat /etc/os-release NAME="CentOS Linux" VERSION="7 (Core)" ID="centos" ID_LIKE="rhel fedora" ...</p></div></div></a></div><div class="card"> <a href="/HYCBlog/posts/web-docker_3/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 7 <i class="unloaded">2020-09-07T19:39:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Docker：一些练习</h3><div class="text-muted small"><p> Docker 部署 Nginx #docker pull nginx # docker run -d --name nginx01 -p 2300:80 nginx #运行nginx，将容器的80端口映射到宿主机的2300端口 3dc65265a4822ac3d635ad26d008521a4ab5b0d9aa9ec880f9cd4b6339a62d7c # curl loca...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/HYCBlog/posts/java-access-control/" class="btn btn-outline-primary"><p>Java访问控制</p></a> <a href="/HYCBlog/posts/leetcode-hard_0/" class="btn btn-outline-primary"><p>处理大数：剑指 Offer 14- II. 剪绳子 II</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><p class="footer-center"> © 2020 <a href="">Yucai Huang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> <br> <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备2020032055号-1</a></p></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/HYCBlog/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/">算法题解</a> <a class="post-tag" href="/HYCBlog/tags/java%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">Java源码学习</a> <a class="post-tag" href="/HYCBlog/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/HYCBlog/tags/web/">web</a> <a class="post-tag" href="/HYCBlog/tags/security/">security</a> <a class="post-tag" href="/HYCBlog/tags/java/">java</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-176388509-1', 'auto'); ga('send', 'pageview'); </script> <script> (function(e,t,n,i,s,a,c){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)} ;a=t.createElement(i);c=t.getElementsByTagName(i)[0];a.async=true;a.src=s ;c.parentNode.insertBefore(a,c) })(window,document,"galite","script","https://cdn.jsdelivr.net/npm/ga-lite@2/dist/ga-lite.min.js"); galite('create', '{"id"=>"UA-176388509-1", "pv"=>{"enabled"=>false, "proxy_url"=>"", "proxy_endpoint"=>"", "cache"=>true}}', 'auto'); galite('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/HYCBlog/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="www.yucaihuang.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
